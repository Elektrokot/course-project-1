import pandas as pd
import pytest


@pytest.fixture
def sample_transactions_list():
    """Возвращает список словарей с тестовыми транзакциями."""
    return [
        {
            "Дата операции": "15.09.2020 10:00:00",
            "Статус": "OK",
            "Сумма операции": -100.0,
            "Валюта операции": "RUB",
            "Сумма платежа": -100.0,
            "Валюта платежа": "RUB",
            "Категория": "Еда",
            "Описание": "Оплата в кафе",
            "Бонусы (включая копейки)": 1.0,
            "Округление на инвесткопилку": 0.0,
            "Счет": "1234567890123456",
        },
        {
            "Дата операции": "16.09.2020 11:00:00",
            "Статус": "OK",
            "Сумма операции": 500.0,
            "Валюта операции": "RUB",
            "Сумма платежа": 500.0,
            "Валюта платежа": "RUB",
            "Категория": "Зарплата",
            "Описание": "Перевод от работодателя",
            "Бонусы (включая копейки)": 0.0,
            "Округление на инвесткопилку": 0.0,
            "Счет": "1234567890123456",
        },
        {
            "Дата операции": "17.09.2020 12:00:00",
            "Статус": "OK",
            "Сумма операции": -200.0,
            "Валюта операции": "RUB",
            "Сумма платежа": -200.0,
            "Валюта платежа": "RUB",
            "Категория": "Переводы",
            "Описание": "Иван И.",
            "Бонусы (включая копейки)": 0.0,
            "Округление на инвесткопилку": 0.0,
            "Счет": "1234567890123456",
        },
        {
            "Дата операции": "18.09.2020 13:00:00",
            "Статус": "OK",
            "Сумма операции": -200.0,
            "Валюта операции": "RUB",
            "Сумма платежа": -200.0,
            "Валюта платежа": "RUB",
            "Категория": "Мобильная связь",
            "Описание": "Тинькофф Мобайл +7 995 555-55-55",
            "Бонусы (включая копейки)": 0.0,
            "Округление на инвесткопилку": 0.0,
            "Счет": "1234567890123456",
        },
    ]


@pytest.fixture
def sample_transactions_df(sample_transactions_list):
    """Возвращает DataFrame с тестовыми транзакциями."""
    df = pd.DataFrame(sample_transactions_list)
    df["Дата операции"] = pd.to_datetime(df["Дата операции"], format="%d.%m.%Y %H:%M:%S")
    return df


@pytest.fixture
def sample_transactions_df_with_invest(sample_transactions_list):
    """Возвращает DataFrame с транзакциями, включая одну с инвесткопилкой."""
    extended_list = sample_transactions_list.copy()
    extended_list.append(
        {
            "Дата операции": "20.09.2020 14:00:00",
            "Статус": "OK",
            "Сумма операции": -50.0,
            "Валюта операции": "RUB",
            "Сумма платежа": -50.0,
            "Валюта платежа": "RUB",
            "Категория": "Еда",
            "Описание": "Покупка продуктов",
            "Бонусы (включая копейки)": 0.5,
            "Округление на инвесткопилку": 10.0,  # <-- Добавляем инвесткопилку
            "Счет": "1234567890123456",
        }
    )
    df = pd.DataFrame(extended_list)
    df["Дата операции"] = pd.to_datetime(df["Дата операции"], format="%d.%m.%Y %H:%M:%S")
    return df


# Фикстура для mock-ответа от Alpha Vantage API
@pytest.fixture
def mock_alpha_vantage_response():
    return {"Global Quote": {"01. symbol": "AAPL", "05. price": "150.0000"}}


# Фикстура для mock-ответа от Currency API (пример)
@pytest.fixture
def mock_currency_response():
    return {"success": True, "rates": {"EUR": 0.85, "USD": 1.0}}
